<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%">

	<mx:Script>
		<![CDATA[
			import net.bing.NewsResult;
			import net.bing.SearchResponse;
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import net.bing.SearchResultEvent;
			import mx.rpc.events.FaultEvent;
			import mx.core.Application;
			import PagableArrayCollection.PagableArrayCollection;
			
			[Bindable]
			public var pagableData:PagableArrayCollection;
			
			[Bindable]
			private var historyData:ArrayCollection = new ArrayCollection();
			
			//Flex calls this a Dictionary, but its commonly known as a Hashmap
			[Bindable]
			public var urlHash:Dictionary = new Dictionary();
			
			public function showResults(e:Event):void
			{
				if(e is FaultEvent)
				{
					Alert.show("Error While Searching.");
					return;
				}
				else if(e is SearchResultEvent)
				{
					var event:SearchResultEvent = e as SearchResultEvent;
					
					//change view in main view stack
					Application.application.resultViewStack.selectedIndex = 1;
					if (event.result.News != null)
					{
						if (event.result.News.Results.length != 0)
						{	
							historyData.addItemAt(event.result, 0);
							history.selectedIndex = 0;
							var resp:SearchResponse = historyData.getItemAt(0) as SearchResponse;	
							
							
									
							list.dataProvider = resp.News.Results;
							
							for (var i:int = 0; i < resp.News.Results.length; i++)
							{
								var nr:NewsResult = resp.News.Results.getNewsResultAt(i);
								if (urlHash[nr.Url] == undefined)
								{
									urlHash[nr.Url] = new ArrayCollection();
									//Create a special Object to hold the NewsResult,
									//but also it's parent, which is a SearchResponse.
									//This allows the program to use the previous
									//search results.
									var obj:Object = new Object();
									obj.parent = resp;
									obj.newsresult = nr;
									ArrayCollection(urlHash[nr.Url]).addItem(obj);
								}
								else
								{
									ArrayCollection(urlHash[nr.Url]).addItem(nr);
								}
							}
						}
						else {
							Alert.show("The Result Array is Empty!!");
						}
					}
					else { 
						Alert.show("Search object is NULL!!");
					}
				
				}
			}
			
			/**
			 * Executed when the user clicks on the list of previous searches
			 */ 
			public function historyListClick(e:Event):void
			{
				var resp:SearchResponse = historyData.getItemAt(history.selectedIndex) as SearchResponse;			
				list.dataProvider = resp.News.Results;
			}
		]]>
	</mx:Script>
	
	<mx:HDividedBox width="100%" height="429">
		
	
	<mx:HBox horizontalAlign="center" >
	<mx:List id="list" width="80%" itemRenderer="SearchResults.SearchResultsItemRenderer" height="419"/>
	
	<mx:List id="history" itemRenderer="SearchResults.HistoryItemRenderer"
		dataProvider="{historyData}" click="historyListClick(event)" height="420"/>
    </mx:HBox>
    
    </mx:HDividedBox>
    
    <mx:HBox horizontalAlign="center" x="304" y="437" height="25">    
    
	<mx:Button label="&lt;&lt;" />
	<mx:Button label=">>" />
	</mx:HBox>
    <mx:Text text="Page 1 0f 1" x="317" y="470"/>
    
</mx:Canvas>
